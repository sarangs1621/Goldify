<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Shop ERP - Testing Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            background: #2563eb;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }
        .section h3 {
            margin-top: 0;
            color: #1f2937;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        .success {
            background: #dcfce7;
            border: 1px solid #16a34a;
            color: #15803d;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #dc2626;
            color: #dc2626;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .result {
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        input, select {
            padding: 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            margin: 5px;
        }
        .form-group {
            margin: 10px 0;
        }
        label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÜ Gold Shop ERP - Comprehensive Testing Interface</h1>
        <p>Testing all modules and functionality of the Gold Shop ERP system</p>
    </div>

    <div class="container">
        <div class="section">
            <h3>üîê Authentication</h3>
            <div class="form-group">
                <label>Username:</label>
                <input type="text" id="username" value="admin" />
            </div>
            <div class="form-group">
                <label>Password:</label>
                <input type="password" id="password" value="admin123" />
            </div>
            <button onclick="login()">Login</button>
            <button onclick="logout()">Logout</button>
            <div id="auth-result"></div>
        </div>

        <div class="section">
            <h3>üìä Dashboard & System Info</h3>
            <button onclick="getDashboard()">Get Dashboard Data</button>
            <button onclick="getUsers()">Get Users</button>
            <div id="dashboard-result"></div>
        </div>

        <div class="section">
            <h3>üì¶ Inventory Management</h3>
            <button onclick="getInventory()">Get Inventory</button>
            <button onclick="getStockTotals()">Get Stock Totals</button>
            <button onclick="createInventoryItem()">Create Test Item</button>
            <div id="inventory-result"></div>
        </div>

        <div class="section">
            <h3>üë• Parties Management</h3>
            <button onclick="getParties()">Get All Parties</button>
            <button onclick="createTestCustomer()">Create Test Customer</button>
            <button onclick="createTestVendor()">Create Test Vendor</button>
            <div id="parties-result"></div>
        </div>

        <div class="section">
            <h3>üíº Job Cards</h3>
            <button onclick="getJobCards()">Get Job Cards</button>
            <button onclick="createTestJobCard()">Create Test Job Card</button>
            <div id="jobcards-result"></div>
        </div>

        <div class="section">
            <h3>üßæ Invoices</h3>
            <button onclick="getInvoices()">Get Invoices</button>
            <button onclick="createTestInvoice()">Create Test Invoice</button>
            <div id="invoices-result"></div>
        </div>

        <div class="section">
            <h3>ü•á Gold Ledger</h3>
            <button onclick="getGoldLedger()">Get Gold Ledger</button>
            <button onclick="createGoldEntry()">Create Gold Entry</button>
            <div id="gold-result"></div>
        </div>

        <div class="section">
            <h3>üí∞ Finance & Transactions</h3>
            <button onclick="getTransactions()">Get Transactions</button>
            <button onclick="getAccounts()">Get Accounts</button>
            <div id="finance-result"></div>
        </div>

        <div class="section">
            <h3>üìà Reports</h3>
            <button onclick="getReports()">Get Available Reports</button>
            <button onclick="getOutstandingReport()">Outstanding Report</button>
            <div id="reports-result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://chrono-gold.preview.emergentagent.com/api';
        let authToken = null;

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            const resultDiv = element.querySelector('.result') || document.createElement('div');
            resultDiv.className = 'result';
            
            if (isError) {
                resultDiv.innerHTML = `<div class="error">Error: ${JSON.stringify(data, null, 2)}</div>`;
            } else {
                resultDiv.innerHTML = `<div class="success">Success!</div>${JSON.stringify(data, null, 2)}`;
            }
            
            if (!element.querySelector('.result')) {
                element.appendChild(resultDiv);
            }
        }

        async function apiCall(endpoint, method = 'GET', data = null) {
            const headers = {
                'Content-Type': 'application/json'
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }

            const config = {
                method,
                headers
            };

            if (data) {
                config.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(`${API_BASE}${endpoint}`, config);
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${JSON.stringify(result)}`);
                }
                
                return result;
            } catch (error) {
                throw error;
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const result = await apiCall('/auth/login', 'POST', { username, password });
                authToken = result.access_token;
                showResult('auth-result', result);
            } catch (error) {
                showResult('auth-result', error.message, true);
            }
        }

        function logout() {
            authToken = null;
            showResult('auth-result', { message: 'Logged out successfully' });
        }

        async function getDashboard() {
            try {
                const result = await apiCall('/dashboard');
                showResult('dashboard-result', result);
            } catch (error) {
                showResult('dashboard-result', error.message, true);
            }
        }

        async function getUsers() {
            try {
                const result = await apiCall('/users');
                showResult('dashboard-result', result);
            } catch (error) {
                showResult('dashboard-result', error.message, true);
            }
        }

        async function getInventory() {
            try {
                const result = await apiCall('/inventory');
                showResult('inventory-result', result);
            } catch (error) {
                showResult('inventory-result', error.message, true);
            }
        }

        async function getStockTotals() {
            try {
                const result = await apiCall('/inventory/stock-totals');
                showResult('inventory-result', result);
            } catch (error) {
                showResult('inventory-result', error.message, true);
            }
        }

        async function createInventoryItem() {
            try {
                const result = await apiCall('/inventory', 'POST', {
                    name: 'Test Gold 22K',
                    purity: 916,
                    current_qty: 10,
                    current_weight: 100.500
                });
                showResult('inventory-result', result);
            } catch (error) {
                showResult('inventory-result', error.message, true);
            }
        }

        async function getParties() {
            try {
                const result = await apiCall('/parties');
                showResult('parties-result', result);
            } catch (error) {
                showResult('parties-result', error.message, true);
            }
        }

        async function createTestCustomer() {
            try {
                const result = await apiCall('/parties', 'POST', {
                    name: 'Test Customer ' + Date.now(),
                    phone: '12345678',
                    address: 'Test Address',
                    party_type: 'customer'
                });
                showResult('parties-result', result);
            } catch (error) {
                showResult('parties-result', error.message, true);
            }
        }

        async function createTestVendor() {
            try {
                const result = await apiCall('/parties', 'POST', {
                    name: 'Test Vendor ' + Date.now(),
                    phone: '87654321',
                    address: 'Vendor Address',
                    party_type: 'vendor'
                });
                showResult('parties-result', result);
            } catch (error) {
                showResult('parties-result', error.message, true);
            }
        }

        async function getJobCards() {
            try {
                const result = await apiCall('/jobcards');
                showResult('jobcards-result', result);
            } catch (error) {
                showResult('jobcards-result', error.message, true);
            }
        }

        async function createTestJobCard() {
            try {
                const result = await apiCall('/jobcards', 'POST', {
                    customer_name: 'Test Customer',
                    customer_phone: '12345678',
                    customer_type: 'walk_in',
                    items: [{
                        description: 'Test Ring',
                        weight_in: 10.500,
                        weight_out: 11.200,
                        making_charges_type: 'flat',
                        making_charges_value: 50.00
                    }],
                    gold_rate_at_jobcard: 25.50
                });
                showResult('jobcards-result', result);
            } catch (error) {
                showResult('jobcards-result', error.message, true);
            }
        }

        async function getInvoices() {
            try {
                const result = await apiCall('/invoices');
                showResult('invoices-result', result);
            } catch (error) {
                showResult('invoices-result', error.message, true);
            }
        }

        async function createTestInvoice() {
            try {
                const result = await apiCall('/invoices', 'POST', {
                    customer_name: 'Test Customer',
                    customer_phone: '12345678',
                    customer_type: 'walk_in',
                    items: [{
                        description: 'Test Item',
                        category: 'Gold 22K',
                        qty: 1,
                        weight: 10.500,
                        rate_per_gram: 25.00,
                        making_charges: 50.00
                    }],
                    vat_percent: 5.0
                });
                showResult('invoices-result', result);
            } catch (error) {
                showResult('invoices-result', error.message, true);
            }
        }

        async function getGoldLedger() {
            try {
                const result = await apiCall('/gold-ledger');
                showResult('gold-result', result);
            } catch (error) {
                showResult('gold-result', error.message, true);
            }
        }

        async function createGoldEntry() {
            try {
                // First get a party to use
                const parties = await apiCall('/parties');
                if (parties.length === 0) {
                    throw new Error('No parties found. Create a customer first.');
                }
                
                const result = await apiCall('/gold-ledger', 'POST', {
                    party_id: parties[0].id,
                    type: 'IN',
                    weight_grams: 25.500,
                    purity_entered: 916,
                    purpose: 'job_work',
                    notes: 'Test gold entry'
                });
                showResult('gold-result', result);
            } catch (error) {
                showResult('gold-result', error.message, true);
            }
        }

        async function getTransactions() {
            try {
                const result = await apiCall('/transactions');
                showResult('finance-result', result);
            } catch (error) {
                showResult('finance-result', error.message, true);
            }
        }

        async function getAccounts() {
            try {
                const result = await apiCall('/accounts');
                showResult('finance-result', result);
            } catch (error) {
                showResult('finance-result', error.message, true);
            }
        }

        async function getReports() {
            try {
                const result = await apiCall('/reports');
                showResult('reports-result', result);
            } catch (error) {
                showResult('reports-result', error.message, true);
            }
        }

        async function getOutstandingReport() {
            try {
                const result = await apiCall('/reports/outstanding');
                showResult('reports-result', result);
            } catch (error) {
                showResult('reports-result', error.message, true);
            }
        }

        // Auto-login on page load
        window.onload = function() {
            login();
        };
    </script>
</body>
</html>